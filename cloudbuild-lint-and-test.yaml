steps:
  # Lints the codebase
  - name: python:3.12.6
    id: lint_proxy_service
    entrypoint: "sh"
    args:
      - "-c"
      - |
        pip install --upgrade pip
        pip install poetry==2.1.2
        make install-dev
        echo "*************************************************************"
        echo "* Linting the codebase...                                   *"
        echo "*************************************************************"
        make lint

  # Tests the codebase
  - name: python:3.12.6
    id: test_proxy_service
    entrypoint: "sh"
    args:
      - "-c"
      - |
        pip install --upgrade pip
        pip install poetry==2.1.2
        make install-dev
        echo "*************************************************************"
        echo "* Testing the codebase...                                   *"
        echo "*************************************************************"
        make test

  # Runs Megalinter on the codebase
  - name: docker
    id: megalint_proxy_service
    entrypoint: "sh"
    args:
      - "-c"
      - |
        echo "*************************************************************"
        echo "* Running Megalinter on the codebase...                     *"
        echo "*************************************************************"
        docker run --platform linux/amd64 --rm \
          -v /var/run/docker.sock:/var/run/docker.sock:rw \
          -v $(pwd):/tmp/lint:rw \
          oxsecurity/megalinter-python:v8.8.0

timeout: 1800s
options:
  logging: CLOUD_LOGGING_ONLY
